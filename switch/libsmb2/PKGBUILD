# Maintainers: Rhys Koedijk <rhys@koedijk.co.nz>, Andr√© Guilherme <andregui17@outlook.com>

pkgname=switch-libsmb2
pkgver=r307.aef1888
pkgrel=1
pkgdesc='SMB2/3 userspace client'
arch=('any')
url='https://github.com/sahlberg/libsmb2'
license=('(L)GPL')
options=(!strip libtool staticlibs)
source=(${pkgname}::"git+https://github.com/Wolf3s/libsmb2.git#commit=67eea946886c63d5496fe11fb83839978b5ca1f9")
sha256sums=('SKIP')
makedepends=('git' 'switch-pkg-config' 'devkitpro-pkgbuild-helpers')
groups=('switch-portlibs')

pkgver() {
  cd "$srcdir/${pkgname}"
  printf 'r%s.%s' "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

build() {
  cd ${pkgname}

  source /opt/devkitpro/switchvars.sh

	cmake -S . -B build "-DCMAKE_TOOLCHAIN_FILE=${DEVKITPRO}/cmake/Switch.cmake" 
	cmake --build build
}

package() {
  cd ${pkgname}
  
	cmake --build build --target install
}
